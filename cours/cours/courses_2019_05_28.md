## Cours 28 mai 2019


### Trigger de validation

```sql

CREATE DEFINER=`root`@`localhost` TRIGGER `insert_client_nom_requis`
	BEFORE INSERT ON `client` FOR EACH ROW
  BEGIN

   set NEW.date_creation = now();

	IF NEW.`nom` is null or NEW.`nom`='' THEN
		SIGNAL SQLSTATE VALUE '45000'
			SET MESSAGE_TEXT = 'Le nom est obligatoire';
	END IF;

	IF NEW.`prenom` is null or NEW.`prenom`='' THEN
		SIGNAL SQLSTATE VALUE '45000'
			SET MESSAGE_TEXT = 'Le prenom est obligatoire';
	END IF;

	IF  NEW.`genre` NOT REGEXP '^[1-3]{1}$' THEN
		SIGNAL SQLSTATE VALUE '45000'
			SET MESSAGE_TEXT = 'Le genre n\'est pas valide';
	END IF;

    IF NEW.`date_de_naissance` is null or NEW.`date_de_naissance`='' THEN
		SIGNAL SQLSTATE VALUE '45000'
			SET MESSAGE_TEXT = 'La date de naissance est obligatoire';
	END IF;

	IF NEW.`email` is null or NEW.`email`='' THEN
		SIGNAL SQLSTATE VALUE '45000'
			SET MESSAGE_TEXT = 'L\'email est obligatoire';
	END IF;

    	IF NEW.`email`  NOT REGEXP "^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$" THEN
		SIGNAL SQLSTATE VALUE '45000'
			SET MESSAGE_TEXT = 'L\'email n\'est pas valide';
	END IF;

     IF NEW.`telephone` is null or NEW.`telephone`='' THEN
		SIGNAL SQLSTATE VALUE '45000'
			SET MESSAGE_TEXT = 'Le téléphone est obligatoire';
	END IF;



END

```
